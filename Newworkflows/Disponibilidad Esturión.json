{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-02-09T18:49:55.000Z",
    "createdAt": "2026-02-09T18:48:49.670Z",
    "versionId": "c6426178-b043-46b5-bd4a-5af9a8485860",
    "workflowId": "QURkLGwyKLMD7n5M",
    "nodes": [
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "Fecha y Hora"
              }
            ]
          }
        },
        "id": "c055762a-8fe7-4141-a639-df2372f30060",
        "typeVersion": 1.1,
        "name": "Disponibilidad Esturión",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          -1168,
          512
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a3949635-7477-4332-9aa6-b6912dee31c4",
                "name": "Disponibilidad",
                "value": false,
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -48,
          608
        ],
        "id": "ac716b75-7631-42af-acf8-a78b836c2cb5",
        "name": "Edit Fields6"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "77a01a69-ca3b-4ba1-97b6-496e734c7128",
                "name": "disponibilidad",
                "value": true,
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -48,
          416
        ],
        "id": "648cbad4-576d-43c2-8581-1476dae0f59f",
        "name": "Edit Fields7"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "307f8081-ea6e-4446-8296-56983cabeb74",
                      "leftValue": "={{ $json.result }}",
                      "rightValue": "={{ $json.start.dateTime }}",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Disponible"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "db38c069-4b77-47e4-9b23-c6e86477c7c5",
                      "leftValue": "={{ $json.result }}",
                      "rightValue": "={{ $json.start.dateTime }}",
                      "operator": {
                        "type": "boolean",
                        "operation": "false",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "No Disponible"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -272,
          512
        ],
        "id": "ae0c0f13-ea49-4bea-859e-fad7631f2b57",
        "name": "Switch4"
      },
      {
        "parameters": {
          "jsCode": "return items.map(item => {\n  const fechaStr = item.json[\"Fecha y Hora\"]; // Corregido: usar el nombre exacto del campo\n  const start = new Date(fechaStr);\n  const end = new Date(start.getTime() + 3 * 60 * 60 * 1000); // +3 horas (cambiado de 1 a 3)\n  \n  // Función para formatear la fecha como YYYY-MM-DDTHH:mm:ss\n  function formatDate(date) {\n    const pad = (num) => num.toString().padStart(2, '0');\n    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;\n  }\n  \n  item.json.start_time = formatDate(start);\n  item.json.end_time = formatDate(end);\n  \n  return item;\n});"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -944,
          512
        ],
        "id": "6cb2913a-c03b-4484-97ac-7746345468b8",
        "name": "Code6"
      },
      {
        "parameters": {
          "jsCode": "// Obtener la fecha y hora del usuario desde el webhook\nconst fechaHoraUsuario = $('Webhook').item.json.fecha;\n\n// Función para verificar si la hora solicitada se solapa con un evento existente\nfunction verificarSolapamiento(inicioEvento, finEvento, usuarioFechaHora) {\n  // Convertir a objetos Date\n  const inicio = new Date(inicioEvento);\n  const fin = new Date(finEvento);\n  const usuarioFecha = new Date(usuarioFechaHora);\n\n  // Si la fecha del usuario cae dentro del rango del evento, hay solapamiento\n  return usuarioFecha >= inicio && usuarioFecha < fin;\n}\n\n// Obtener todos los eventos del calendario\nconst todosLosEventos = items;\n\n// Normalizar la fecha del usuario (zona horaria Europe/Madrid si no existe)\nlet fechaHoraNormalizada = fechaHoraUsuario;\nif (!fechaHoraNormalizada.includes('+')) {\n  fechaHoraNormalizada += '+02:00';\n}\n\n// Buscar eventos que se solapen con la fecha y hora solicitadas\nconst eventosCoincidentes = todosLosEventos.filter(evento => {\n  const inicioEvento = evento.json.start.dateTime;\n  const finEvento = evento.json.end.dateTime;\n\n  // Verificar solapamiento con el rango del evento\n  return verificarSolapamiento(inicioEvento, finEvento, fechaHoraNormalizada);\n});\n\n// Determinar disponibilidad\nconst estaDisponible = eventosCoincidentes.length === 0;\n\n// Preparar la respuesta\nconst respuesta = {\n  result: estaDisponible,\n  debug: {\n    fechaHoraSolicitada: fechaHoraUsuario,\n    fechaHoraNormalizada: fechaHoraNormalizada,\n    eventosEncontrados: todosLosEventos.map(evento => ({\n      id: evento.json.id,\n      summary: evento.json.summary,\n      start: evento.json.start.dateTime,\n      end: evento.json.end.dateTime,\n      solapa: verificarSolapamiento(evento.json.start.dateTime, evento.json.end.dateTime, fechaHoraNormalizada)\n    })),\n    eventosCoincidentes: eventosCoincidentes.map(evento => ({\n      id: evento.json.id,\n      summary: evento.json.summary,\n      start: evento.json.start.dateTime,\n      end: evento.json.end.dateTime\n    }))\n  }\n};\n\n// Devolver la respuesta como un nuevo item\nreturn [{ json: respuesta }];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -496,
          512
        ],
        "id": "3fc32531-b3ce-42ca-8c91-4019bcbe7477",
        "name": "Code7"
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "3cf455fae61998f2cf7bfffba57a4e28188afc46dd5d892692826a9254905124@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Restaurante Esturión"
          },
          "timeMin": "={{ $json['Fecha y Hora'] }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.3,
        "position": [
          -720,
          512
        ],
        "id": "e7a5ae39-258d-4442-a79b-0cdcc544075f",
        "name": "Get many events",
        "alwaysOutputData": false,
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "BxLdTiBYRwntbItp",
            "name": "Google Calendar account 2"
          }
        }
      }
    ],
    "connections": {
      "Disponibilidad Esturión": {
        "main": [
          [
            {
              "node": "Code6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch4": {
        "main": [
          [
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code6": {
        "main": [
          [
            {
              "node": "Get many events",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code7": {
        "main": [
          [
            {
              "node": "Switch4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get many events": {
        "main": [
          [
            {
              "node": "Code7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Carlos Fernández",
    "name": "Disponibilidad Esturión",
    "description": "",
    "autosaved": true
  },
  "activeVersionId": "c6426178-b043-46b5-bd4a-5af9a8485860",
  "connections": {
    "Disponibilidad Esturión": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Get many events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many events": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2026-02-07T00:00:35.501Z",
  "id": "QURkLGwyKLMD7n5M",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Disponibilidad Esturión",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "Fecha y Hora"
            }
          ]
        }
      },
      "id": "c055762a-8fe7-4141-a639-df2372f30060",
      "typeVersion": 1.1,
      "name": "Disponibilidad Esturión",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -1168,
        512
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3949635-7477-4332-9aa6-b6912dee31c4",
              "name": "Disponibilidad",
              "value": false,
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -48,
        608
      ],
      "id": "ac716b75-7631-42af-acf8-a78b836c2cb5",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77a01a69-ca3b-4ba1-97b6-496e734c7128",
              "name": "disponibilidad",
              "value": true,
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -48,
        416
      ],
      "id": "648cbad4-576d-43c2-8581-1476dae0f59f",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "307f8081-ea6e-4446-8296-56983cabeb74",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "={{ $json.start.dateTime }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Disponible"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "db38c069-4b77-47e4-9b23-c6e86477c7c5",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "={{ $json.start.dateTime }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "No Disponible"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -272,
        512
      ],
      "id": "ae0c0f13-ea49-4bea-859e-fad7631f2b57",
      "name": "Switch4"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const fechaStr = item.json[\"Fecha y Hora\"]; // Corregido: usar el nombre exacto del campo\n  const start = new Date(fechaStr);\n  const end = new Date(start.getTime() + 3 * 60 * 60 * 1000); // +3 horas (cambiado de 1 a 3)\n  \n  // Función para formatear la fecha como YYYY-MM-DDTHH:mm:ss\n  function formatDate(date) {\n    const pad = (num) => num.toString().padStart(2, '0');\n    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;\n  }\n  \n  item.json.start_time = formatDate(start);\n  item.json.end_time = formatDate(end);\n  \n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -944,
        512
      ],
      "id": "6cb2913a-c03b-4484-97ac-7746345468b8",
      "name": "Code6"
    },
    {
      "parameters": {
        "jsCode": "// Obtener la fecha y hora del usuario desde el webhook\nconst fechaHoraUsuario = $('Webhook').item.json[\"Fecha y Hora\"];\n\n// Función para verificar si la hora solicitada se solapa con un evento existente\nfunction verificarSolapamiento(inicioEvento, finEvento, usuarioFechaHora) {\n  // Convertir a objetos Date\n  const inicio = new Date(inicioEvento);\n  const fin = new Date(finEvento);\n  const usuarioFecha = new Date(usuarioFechaHora);\n  \n  // Si la fecha del usuario cae dentro del rango del evento, hay solapamiento\n  return usuarioFecha >= inicio && usuarioFecha < fin;\n}\n\n// Obtener todos los eventos del calendario\nconst todosLosEventos = items;\n\n// Normalizar la fecha del usuario (zona horaria Europe/Madrid si no existe)\nlet fechaHoraNormalizada = fechaHoraUsuario;\nif (!fechaHoraNormalizada.includes('+') && !fechaHoraNormalizada.includes('Z')) {\n  fechaHoraNormalizada += '+01:00'; // +01:00 para hora estándar de Madrid (invierno)\n}\n\n// Buscar eventos que se solapen con la fecha y hora solicitadas\nconst eventosCoincidentes = todosLosEventos.filter(evento => {\n  const inicioEvento = evento.json.start?.dateTime ||"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -496,
        512
      ],
      "id": "3fc32531-b3ce-42ca-8c91-4019bcbe7477",
      "name": "Code7"
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "3cf455fae61998f2cf7bfffba57a4e28188afc46dd5d892692826a9254905124@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Restaurante Esturión"
        },
        "timeMin": "={{ $json.start_time }}",
        "timeMax": "={{ $json.end_time }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        -720,
        512
      ],
      "id": "e7a5ae39-258d-4442-a79b-0cdcc544075f",
      "name": "Get many events",
      "alwaysOutputData": false,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "BxLdTiBYRwntbItp",
          "name": "Google Calendar account 2"
        }
      }
    }
  ],
  "pinData": {
    "Disponibilidad Esturión": [
      {
        "json": {
          "Fecha y Hora": "2026-08-30T23:00:00"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "shared": [
    {
      "updatedAt": "2026-02-07T00:00:35.513Z",
      "createdAt": "2026-02-07T00:00:35.513Z",
      "role": "workflow:owner",
      "workflowId": "QURkLGwyKLMD7n5M",
      "projectId": "Mg9CftDHMIrQGniA"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2026-02-12T16:31:36.064Z",
  "versionId": "00240f5a-ca0f-4541-b7de-b50fe7a03145"
}