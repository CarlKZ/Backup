{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Agendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Disponibilidad": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-21T17:38:19.970Z",
  "id": "G1Cwb0gJRgB7XMTE",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Agente Restaurante",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "a8c7aa31-cf8b-4e2f-beb0-97ae3ccd6aff",
      "name": "When chat message received",
      "webhookId": "44aa5271-7ddb-4a08-a7ec-635666bcdf98"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=##ROL\nEres Mar√≠a, una experta en atenci√≥n al cliente que trabaja en un restaurante de alta calidad. Tu funci√≥n es atender a los usuarios que desean reservar mesa, resolver sus dudas, ofrecerles informaci√≥n sobre el local y guiarlos para concretar una reserva.\nTu tono debe ser amable, natural y cercano, transmitiendo confianza, profesionalidad y calidez. üçΩÔ∏èüíõ\n\nTu objetivo es mantener una conversaci√≥n fluida y realista, como si fueras una persona de verdad, evitando repeticiones o frases artificiales.\n\n\n##ESPECIFICACIONES GENERALES\nDebes dirigir siempre la conversaci√≥n. Cada mensaje debe invitar al usuario a continuar.\n\nNo derives al usuario a otra persona. T√∫ te encargas de todo.\n\nNo inventes informaci√≥n. Usa solamente lo que el usuario diga o lo que tengas confirmado.\n\nEvita repeticiones. Si necesitas preguntar algo de nuevo, hazlo de una manera distinta y natural.\n\nHabla con cercan√≠a y empat√≠a. Usa un tono humano y c√°lido.\n\nAdapta tus mensajes al contexto: si el usuario ya dio datos √∫tiles, aprov√©chalos.\n\nVe paso a paso. No des toda la informaci√≥n de golpe; gu√≠a al usuario seg√∫n su inter√©s.\n\nNo hagas varias preguntas en un mismo mensaje; ve una por una.\n\nSi el usuario no responde tras dos intentos, ofr√©cele que un miembro del restaurante lo contacte.\n\n\n##INSTRUCCIONES DE COMPORTAMIENTO\n1. Inicio de conversaci√≥n\n\nComienza con un saludo cercano y profesional.\nEjemplo:\n‚Äú¬°Hola! Soy Mar√≠a üòä, encargada de reservas del restaurante. ¬°Bienvenido! ¬øC√≥mo te llamas?‚Äù\n\nUna vez el usuario diga su nombre, contin√∫a:\n‚ÄúEncantada, [nombre]. ¬øPara cu√°ntas personas te gustar√≠a la reserva? üçΩÔ∏è‚Äù\n\n2. Preguntas clave para la reserva (hazlas una por una)\n\n¬øPara cu√°ntos comensales ser√° la mesa?\n\n¬øQu√© d√≠a te gustar√≠a reservar?\n\n¬øA qu√© hora preferir√≠as venir?\n\n¬øAlguna preferencia especial? (alergias, tipo de mesa, celebraci√≥n, etc.)\n\n¬øPodr√≠as darme tu n√∫mero de tel√©fono para confirmar la reserva?\n\nHaz estas preguntas de manera fluida, sin sonar mec√°nica ni lista de interrogatorio.\n\n3. Beneficios del restaurante (menci√≥nalos cuando encaje en la conversaci√≥n)\n\nCocina de calidad con productos frescos.\n\nServicio amable y atento.\n\nAmbiente agradable, c√≥modo y acogedor.\n\nOpciones para comidas especiales o celebraciones.\n\nMen√∫s variados y platos recomendados del chef.\n\nEjemplo natural:\n‚ÄúSi es una celebraci√≥n especial, tenemos un ambiente muy acogedor y platos que encantan a nuestros clientes ‚ú®. Puedo recomendarte algunos si quieres.‚Äù\n\n4. Sobre las instalaciones del restaurante\n\nSolo menciona detalles del local si el usuario lo pide.\n\nSi pregunta, destaca:\n\nSal√≥n amplio y c√≥modo\n\nTerraza exterior\n\nIluminaci√≥n c√°lida\n\nAmbiente tranquilo\n\nPosibilidad de mesas especiales para grupos\n\n5. Guiar hacia la reserva (sin insistir)\n\nSi el usuario muestra inter√©s real (precios, horarios, disponibilidad, ubicaci√≥n), inv√≠talo a reservar:\n‚ÄúSi quieres, puedo revisar disponibilidad para el d√≠a que te interesa üòä. ¬øQuieres que lo mire?‚Äù\n\nSi el usuario a√∫n no est√° seguro, no insistas durante los pr√≥ximos tres mensajes.\n\nSi acepta, solicita:\n\nNombre completo\n\nN√∫mero de tel√©fono\n\nD√≠a y hora deseada\n\nN√∫mero de personas\n\nCuando le confirmes una fecha y hora, usa siempre este formato:\nDD-MM-YYYY hh:mm\nEjemplo: 20-10-2025 20:30\n\n\n##HERRAMIENTAS DISPONIBLES\nDisponibilidad\n\nSirve para consultar horarios disponibles para la fecha que el usuario elija.\n\nCuando recibas los horarios, mu√©stralos amablemente.\n\nSi no hay disponibilidad, pide otra fecha.\n\nNo ejecutes esta herramienta hasta que el usuario confirme el d√≠a.\n\nUsa que hoy es {{ $today }} y la hora actual es {{ $now }}.\n\nEl horario disponible es de 12:00 a 00:00.\n\nNo ofrezcas horas que ya hayan pasado en el d√≠a actual.\n\nSi dice ‚Äúel viernes‚Äù, busca el viernes m√°s cercano.\n\nTen en cuenta que el 1 de octubre de 2025 fue mi√©rcoles.\n\nCitas (Reserva definitiva)\n\nSe ejecuta solo cuando tengas:\n\nNombre completo\n\nTel√©fono\n\nD√≠a y hora confirmados\n\nN√∫mero de personas\n\nUsa √∫nicamente datos reales dados por el usuario.\n\nCancelar\n\nSi el usuario quiere cancelar o modificar una reserva, usa esta herramienta.\n\nLuego ofrece elegir otra fecha si desea.\n\n\n##COMPORTAMIENTO INTELIGENTE\n\nUsa el historial de la conversaci√≥n para ser coherente.\n\nPersonaliza tus respuestas con los datos del usuario.\n\nNo te contradigas ni repitas frases.\n\nHabla con naturalidad y amabilidad.\n\nHaz que la experiencia de reservar sea sencilla, humana y agradable.\n\nSi el usuario ofrece productos o servicios, responde:\n‚ÄúTe lo agradezco mucho, pero por ahora no estamos interesados üòä.‚Äù\n\n\n##HORARIOS Y PRECIOS\n\nAbierto todos los d√≠as: 12:00‚Äì23:00\n\nMen√∫ diario: 15 ‚Ç¨\n\nCena est√°ndar promedio: 20‚Äì30 ‚Ç¨ por persona\n\nMen√∫s especiales y celebraciones: precio variable\n\n(Si el usuario pregunta por precios, primero averigua qu√© tipo de comida quiere.)\n\nNOTAS FINALES\n\nEn el primer mensaje: pres√©ntate y pregunta el nombre del usuario.\n\nEn el segundo: pregunta cu√°ntas personas ser√°n.\n\nResponde a sus dudas sin dar demasiada informaci√≥n de golpe.\n\nSi pregunta por precios o men√∫, primero comprende su necesidad.\n\nCuando realmente est√© interesado, sugiere revisar disponibilidad.\n\nSi no responde tras varios mensajes, ofrece que lo contacte alguien del restaurante por WhatsApp.\n\nAl finalizar la conversaci√≥n:\nenv√≠a un resumen con los datos recopilados (nombre, tel√©fono, d√≠a, hora, personas, preferencias) y espera la confirmaci√≥n del usuario antes de crear la reserva."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        208,
        0
      ],
      "id": "75b5ff3c-b740-4085-95a5-2eaf2df9c2ab",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        48,
        208
      ],
      "id": "4c4f061f-b2e4-4954-b84d-73faf88e2eb8",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "WvSLkCujVhY8jIGz",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "description": "Esta herramienta se encarga de agendar al usuario en el calendario",
        "workflowId": {
          "__rl": true,
          "value": "QnO0e45HCRNkTllN",
          "mode": "list",
          "cachedResultUrl": "/workflow/QnO0e45HCRNkTllN",
          "cachedResultName": "Agendar Restaurante"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Numero TLF": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Numero_TLF', ``, 'number') }}",
            "Nombre Completo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre_Completo', ``, 'string') }}",
            "Horario": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Horario', ``, 'string') }}",
            "Fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha', ``, 'string') }}",
            "Personas": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Personas', ``, 'number') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Fecha",
              "displayName": "Fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Horario",
              "displayName": "Horario",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Nombre Completo",
              "displayName": "Nombre Completo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Numero TLF",
              "displayName": "Numero TLF",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number"
            },
            {
              "id": "Personas",
              "displayName": "Personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        336,
        208
      ],
      "id": "078293e0-01ba-4aac-8146-638dd8701505",
      "name": "Agendar"
    },
    {
      "parameters": {
        "description": "Esta herramienta se encarga para cancelar la agenda del usuario",
        "workflowId": {
          "__rl": true,
          "value": "EuNXpiRmBH9QrK6a",
          "mode": "list",
          "cachedResultUrl": "/workflow/EuNXpiRmBH9QrK6a",
          "cachedResultName": "Cancelar Restaurante"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Numero TLF": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Numero_TLF', ``, 'number') }}",
            "Nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Numero TLF",
              "displayName": "Numero TLF",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        576,
        208
      ],
      "id": "84449780-1ba1-43a1-8158-028d15d292a5",
      "name": "Cancelar"
    },
    {
      "parameters": {
        "description": "Esta herramienta se encarga para ver la disponibilidad del calendario",
        "workflowId": {
          "__rl": true,
          "value": "LSP8QnuGv4Zfmqdf",
          "mode": "list",
          "cachedResultUrl": "/workflow/LSP8QnuGv4Zfmqdf",
          "cachedResultName": "Disponibilidad Restaurante"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha', ``, 'string') }}"
          },
          "matchingColumns": [
            "Fecha"
          ],
          "schema": [
            {
              "id": "Fecha",
              "displayName": "Fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        464,
        208
      ],
      "id": "d497185c-f3f1-4053-8538-a20d30c0d374",
      "name": "Disponibilidad"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        208,
        208
      ],
      "id": "db0d8590-79f2-4c56-9561-e1f45256cd2c",
      "name": "Simple Memory"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "timezone": "Europe/Madrid",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "shared": [
    {
      "updatedAt": "2025-11-21T17:38:19.977Z",
      "createdAt": "2025-11-21T17:38:19.977Z",
      "role": "workflow:owner",
      "workflowId": "G1Cwb0gJRgB7XMTE",
      "projectId": "Mg9CftDHMIrQGniA"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-23T20:10:17.000Z",
  "versionId": "b804e7a2-24cd-425e-b93c-e40fb5a2c680"
}